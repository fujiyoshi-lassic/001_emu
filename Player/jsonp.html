<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="./js/jquery-1.12.0.min.js"></script>
        <script type="text/javascript">
            function getApi() {
                // 多重送信を防ぐため通信完了までボタンをdisableにする
                var button = $(this);
                button.attr("disabled", true);
                
                var param = 'userid=' + $("#userid").val();
                param += '&keyid=' + $("#keyid").val();
                param += '&onetimekey=' + $("#onetimekey").val();
                param += '&usagetype=' + $("#usagetype").val();
                param += '&devicetype=' + $("#devicetype").val();
                param += '&outputquality=' + $("#outputquality").val();
                param += '&drmkeyid=' + $("#drmkeyid").val();

                // 通信実行
                $.ajax({
                    type:"post",                                                // method = "POST"
                    //url:"http://localhost:8084/ApiServer/webresources/generic", // POST送信先のURL
                    //url:"http://api-sv/ApiServer/token.php",                    // POST送信先のURL
                    url:"http://api-sv:8084/ApiServer/webresources/generic",
                    data:param,                                  // JSONデータ本体
                    contentType: 'application/json',                            // リクエストの Content-Type
                    dataType: "jsonp",                                           // レスポンスをJSONとしてパースする
                    //jsonpCallback:'tokenData',
                    success: function(json_data) {                             // 200 OK時
                        
                        alert(json_data.returnCd + '\n'
                            + json_data.tokenInfo + '\n'
                            + json_data.usageType + '\n'
                            + json_data.beginDate + '\n'
                            + json_data.expirationDate + '\n'
                            + json_data.messageText + '\n'
                        );
                    },
                    error: function(json_data) {         // HTTPエラー時
                        alert(json_data);
                        alert("error");
                        //alert("Server Error. Pleasy try again later.");
                    },
                    complete: function() {      // 成功・失敗に関わらず通信が終了した際の処理
                        button.attr("disabled", false);  // ボタンを再び enableにする
                    }
                });
            }
        </script>
    </head>
    <body>
        <form class="form-horizontal">
            <table>
                <tr>
                    <td>
                        コンテンツ購入者のユーザID
                    </td>
                    <td>
                        <input id="userid" type="text" value="user123456"/>
                    </td>
                </tr>
                <tr>
                    <td>
                        購入チェック対象のコンテンツ識別子
                    </td>
                    <td>
                        <input id="keyid" type="text" value="CONT00001"/>
                    </td>
                </tr>
                <tr>
                    <td>
                        ワンタイムキー
                    </td>
                    <td>
                        <input id="onetimekey" type="text" value="FKEKLV51HD7HDYE589FV"/>
                    </td>
                </tr>
                <tr>
                    <td>
                        配信種別
                    </td>
                    <td>
                        <input id="usagetype" type="text" value="stream"/>
                    </td>
                </tr>
                <tr>
                    <td>
                        再生端末タイプ
                    </td>
                    <td>
                        <input id="devicetype" type="text" value="PC"/>
                    </td>
                </tr>
                <tr>
                    <td>
                        映像品質
                    </td>
                    <td>
                        <input id="outputquality" type="text" value="HD"/>
                    </td>
                </tr>
                <tr>
                    <td>
                        UUIDの形態のDRM KEY ID
                    </td>
                    <td>
                        <input id="drmkeyid" type="text" value="EDEF8BA9-79D6-4ACE-A3C8-27DCD51D21ED"/>
                    </td>
                </tr>
            </table>
            <button id="update" type="button" onclick="getApi()">更新</button>
        </form>
    </body>
</html>
